name: generate snake with custom colors

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Clean old snake files
        run: |
          rm -f output/github-snake.svg
          rm -f output/github-snake-dark.svg
          mkdir -p output

      - name: Generate snake animation
        uses: Platane/snk@v3
        with:
          github_user_name: Josan31
          outputs: |
            output/github-snake.svg
            output/github-snake-dark.svg

      - name: Apply custom colors to snake
        run: |
          python3 - <<EOF
          import re

          # Rutas de los SVG
          files = ["output/github-snake.svg", "output/github-snake-dark.svg"]

          # Colores que quieres aplicar
          snake_color = "#00FF7F"       # color de la serpiente
          background_color = "#001f2b"  # fondo
          text_color = "#00E5FF"        # cuadros o detalles

          for file in files:
              with open(file, "r") as f:
                  svg = f.read()

              # Cambiar color del snake (morado por defecto)
              svg = re.sub(r'fill="#[0-9a-fA-F]{6}"', f'fill="{snake_color}"', svg)

              # Cambiar color de fondo
              svg = re.sub(r'<rect width="100%" height="100%" fill="[^"]+"', f'<rect width="100%" height="100%" fill="{background_color}"', svg)

              # Cambiar otros textos o detalles si quieres
              svg = re.sub(r'<text[^>]*fill="[^"]+"', f'<text fill="{text_color}"', svg)

              with open(file, "w") as f:
                  f.write(svg)
          EOF

      - name: Push snake animation to output branch
        uses: crazy-max/ghaction-github-pages@v4
        with:
          target_branch: output
          build_dir: output
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
